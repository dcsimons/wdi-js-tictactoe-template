// Generated by CoffeeScript 1.7.1
var game;

game = game || {};

game.TicTacToe = angular.module("TicTacToe", []);

game.TicTacToe.controller("GameController", function($scope) {
  $scope.players = [
    {
      name: "Baloo",
      marker: "X",
      img_url: "img/baloo.gif",
      tilesSelected: [],
      indicator: "current"
    }, {
      name: "King Louie",
      marker: "O",
      img_url: "img/kingLouie.png",
      tilesSelected: [],
      indicator: null
    }
  ];
  $scope.board = [
    {
      position: 0,
      clicked: false,
      img_url: null
    }, {
      position: 1,
      clicked: false,
      img_url: null
    }, {
      position: 2,
      clicked: false,
      img_url: null
    }, {
      position: 3,
      clicked: false,
      img_url: null
    }, {
      position: 4,
      clicked: false,
      img_url: null
    }, {
      position: 5,
      clicked: false,
      img_url: null
    }, {
      position: 6,
      clicked: false,
      img_url: null
    }, {
      position: 7,
      clicked: false,
      img_url: null
    }, {
      position: 8,
      clicked: false,
      img_url: null
    }
  ];
  $scope.currentPlayer = $scope.players[0];
  $scope.turns = 0;
  $scope.winCombos = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];
  $scope.gameOver = {
    show: false,
    message: null,
    img_url: null
  };
  $scope.selectTile = function(tile) {
    if (tile.clicked) {
      alert("Position already selected.  Please select another tile.");
    } else {
      tile.clicked = true;
      $scope.turns += 1;
      tile.img_url = $scope.currentPlayer.img_url;
      $scope.currentPlayer.tilesSelected.push(tile.position);
      if (!$scope.isWin($scope.currentPlayer.tilesSelected)) {
        if (!$scope.isTie()) {
          $scope.togglePlayer();
        }
      }
    }
  };
  $scope.togglePlayer = function() {
    if ($scope.currentPlayer === $scope.players[0]) {
      $scope.currentPlayer = $scope.players[1];
      $scope.players[1].indicator = "current";
      $scope.players[0].indicator = null;
    } else {
      $scope.currentPlayer = $scope.players[0];
      $scope.players[0].indicator = "current";
      $scope.players[1].indicator = null;
    }
  };
  $scope.isWin = function(playerTiles) {
    var combo, _i, _len, _ref;
    _ref = $scope.winCombos;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      combo = _ref[_i];
      if (playerTiles.indexOf(combo[0]) >= 0 && playerTiles.indexOf(combo[1]) >= 0 && playerTiles.indexOf(combo[2]) >= 0) {
        $scope.gameOver.show = true;
        $scope.gameOver.message = $scope.currentPlayer.name + "wins!";
        $scope.gameOver.img_url = $scope.currentPlayer.img_url;
        return true;
      }
    }
    return false;
  };
  $scope.isTie = function() {
    if ($scope.turns === 9) {
      $scope.gameOver.show = true;
      $scope.gameOver.message = "Game ends in a tie!";
      $scope.gameOver.img_url = "img/tied_knot.jpg";
      return true;
    }
    return false;
  };
  $scope.newGame = function() {
    return window.location.href = window.location.href;
  };
});
